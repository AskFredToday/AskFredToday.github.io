riot.tag2("af-jssip",'<audio id="remoteAudio"></audio><af-input id="jssip" label="Number" bus="{bus}" initvalue="{opts.number}"></af-input><af-button buttontext="Dial" bus="{bus}"></af-button>',"","",function(e){function n(){var n=new JsSIP.WebSocketInterface(e.wsurl),s={sockets:[n],uri:e.uri,password:e.password,session_timers:!1};o.ua=new JsSIP.UA(s),o.ua.start(),o.eventHandlers={progress:function(e){console.log("call is in progress")},failed:function(e){console.log("call failed with cause: "+e.cause)},ended:function(e){console.log("call ended with cause: "+e.cause)},confirmed:function(e){console.log("call confirmed");var n=o.session.connection.getLocalStreams()[0];dtmfSender=o.session.connection.createDTMFSender(n.getAudioTracks()[0])},accepted:function(e){var n=document.getElementById("remoteAudio");n.src=window.URL.createObjectURL(o.session.connection.getRemoteStreams()[0]),n.play()}},o.options={eventHandlers:o.eventHandlers,mediaConstraints:{audio:!0,video:!1}},o.ua.on("registered",function(){console.log("Registered")}),o.ua.on("newRTCSession",function(e){console.log(e)})}var o=this;if(o.bus=riot.observable(),o.number=o.opts.number,o.bus.on("click",function(){o.opts.bus.trigger("dial",o.number)}),o.bus.on("newValue",function(e,n){o.number=n}),e.bus&&e.bus.on("dial",function(e){o.session=o.ua.call(e,o.options)}),window.hasOwnProperty("JsSIP"))n();else{var s=document.createElement("script");s.src="https://cdnjs.cloudflare.com/ajax/libs/jssip/3.0.3/jssip.min.js",s.onload=function(){n()},document.head.appendChild(s)}});