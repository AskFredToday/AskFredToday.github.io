riot.tag2("af-jssip",'<audio id="remoteAudio"></audio><af-input id="jssip" label="Number" bus="{bus}" initvalue="{opts.number}"></af-input><af-button buttontext="Dial" bus="{dialbus}"></af-button><af-button buttontext="Mute" bus="{mutebus}"></af-button>',"","",function(e){function s(){var s=new JsSIP.WebSocketInterface(e.wsurl),t={sockets:[s],uri:e.uri,password:e.password,session_timers:!1};n.ua=new JsSIP.UA(t),n.ua.start(),n.eventHandlers={progress:function(e){console.log("call is in progress")},failed:function(e){console.log("call failed with cause: "+e.cause)},ended:function(e){console.log("call ended with cause: "+e.cause)},confirmed:function(e){console.log("call confirmed");var s=n.session.connection.getLocalStreams()[0];dtmfSender=n.session.connection.createDTMFSender(s.getAudioTracks()[0])},accepted:function(e){var s=document.getElementById("remoteAudio");s.src=window.URL.createObjectURL(n.session.connection.getRemoteStreams()[0]),s.play()}},n.options={eventHandlers:n.eventHandlers,mediaConstraints:{audio:!0,video:!1}},n.ua.on("registered",function(){console.log("Registered")}),n.ua.on("newRTCSession",function(e){console.log(e)})}var n=this;if(n.bus=riot.observable(),n.number=n.opts.number,n.dialbus=riot.observable(),n.dialbus.on("click",function(){n.session?n.opts.bus.trigger("hangup"):n.opts.bus.trigger("dial",n.number)}),n.mutebus=riot.observable(),n.mutebus.on("click",function(){n.session&&n.opts.bus.trigger("togglemute",n.number)}),n.bus.on("newValue",function(e,s){n.number=s}),e.bus&&e.bus.on("dial",function(e){n.session=n.ua.call(e,n.options),n.dialbus.trigger("updatebuttontext","Hangup")}),e.bus&&e.bus.on("hangup",function(){n.session.terminate(),n.session=null,n.dialbus.trigger("updatebuttontext","Dial")}),e.bus&&e.bus.on("togglemute",function(){var e=n.session.isMuted();e.audio?n.session.unmute({audio:!0,video:!0}):n.session.mute({audio:!0,video:!0}),n.mutebus.trigger("updatebuttontext",e.audio?"MUTE":"UNMUTE")}),window.hasOwnProperty("JsSIP"))s();else{var t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/jssip/3.0.3/jssip.min.js",t.onload=function(){s()},document.head.appendChild(t)}});