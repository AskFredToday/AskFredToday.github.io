riot.tag2("af-jssip",'<audio id="remoteAudio"></audio><af-input id="jssip" label="Number" bus="{bus}" initvalue="{opts.number}"></af-input><af-button buttontext="Dial" bus="{bus}"></af-button>',"","",function(e){function n(){var n=new JsSIP.WebSocketInterface(e.wsurl),o={sockets:[n],uri:e.uri,password:e.password,session_timers:!1};s.ua=new JsSIP.UA(o),s.ua.start(),s.eventHandlers={progress:function(e){console.log("call is in progress")},failed:function(e){console.log("call failed with cause: "+e.cause)},ended:function(e){console.log("call ended with cause: "+e.cause)},confirmed:function(e){console.log("call confirmed");var n=s.session.connection.getLocalStreams()[0];dtmfSender=s.session.connection.createDTMFSender(n.getAudioTracks()[0])},accepted:function(e){var n=document.getElementById("remoteAudio");n.src=window.URL.createObjectURL(s.session.connection.getRemoteStreams()[0]),n.play()}},s.options={eventHandlers:s.eventHandlers,mediaConstraints:{audio:!0,video:!1}},s.ua.on("registered",function(){console.log("Registered")}),s.ua.on("newRTCSession",function(e){console.log(e)})}var s=this;if(s.bus=riot.observable(),s.number=s.opts.number,s.bus.on("click",function(){s.session?(s.session.terminate(),s.session=null,s.bus.trigger("updatebuttontext","Dial")):s.opts.bus.trigger("dial",s.number)}),s.bus.on("newValue",function(e,n){s.number=n}),e.bus&&e.bus.on("dial",function(e){s.session=s.ua.call(e,s.options),s.bus.trigger("updatebuttontext","Hangup")}),window.hasOwnProperty("JsSIP"))n();else{var o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/jssip/3.0.3/jssip.min.js",o.onload=function(){n()},document.head.appendChild(o)}});