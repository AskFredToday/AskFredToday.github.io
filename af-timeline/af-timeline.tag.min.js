riot.tag2("af-timeline",'<div class="menu"><af-timepicker label="Start" min="{min}" max="{max}" initvalue="{max}" bus="{timeBus}"></af-timepicker><input type="image" onclick="{zoomIn}" title="Zoom In" src="img/zin.png"><input type="image" onclick="{zoomOut}" title="Zoom Out" src="img/zout.png"><input type="image" onclick="{moveLeft}" title="Move Left" src="img/fr.png"><input type="image" onclick="{moveRight}" title="Move Right" src="img/ff.png"></div><div></div>',"","",function(t){function e(t){var e=s.timeline.getWindow(),i=e.end-e.start,n={start:new Date(e.start.valueOf()-i*t),end:new Date(e.end.valueOf()+i*t)};s.setTimelineWindow(n),setTimeout(function(){s.opts.bus&&s.opts.bus.trigger("newRange",n)},200)}function i(t){var e=s.timeline.getWindow(),i=e.end-e.start,n={start:new Date(e.start.valueOf()-i*t),end:new Date(e.end.valueOf()-i*t)};s.setTimelineWindow(n),setTimeout(function(){s.opts.bus&&s.opts.bus.trigger("newRange",n)},200)}function n(t,e){s.timeline.getWindow();s.setTimelineWindow({start:t,end:e})}var s=this;this.timeBus=riot.observable(),this.timeBus.on("value",function(t){var e=s.timeline.getWindow(),i=e.end-e.start,n={start:t,end:new Date(t.valueOf()+i)};s.timeline.setWindow(n),setTimeout(function(){s.opts.bus&&s.opts.bus.trigger("newRange",n)},200)}),this.max=new Date,this.min=new Date(this.max-6048e5),this.setTimelineWindow=function(t){s.timeBus.trigger("newValue",t.start),s.timeline.setWindow(t)},this.moveLeft=function(){i(.9)}.bind(this),this.moveRight=function(){i(-.9)}.bind(this),this.zoomIn=function(){e(-.3)}.bind(this),this.zoomOut=function(){e(.5)}.bind(this),this.items=new vis.DataSet,this.on("mount",function(){window.increment=window.increment?window.increment+1:1,this.localId="timeline"+window.increment,this.root.children[1].id=this.localId;var e=new Date,i=this.root.firstChild,n=function(t){return t.img?'<div title="'+t.title+'"><img src="'+t.img+'"></div>':"<div>"+t.title+"</div>"},o={template:n,orientation:"top",start:this.opts.starttime||e,end:this.opts.endtime||e.valueOf()+6e5,editable:{add:!0,updateTime:!0,updateGroup:!1,remove:!0},maxHeight:"400px",onAdd:function(e,i){1==e.group&&(e.title="Ad",e.end=e.start.valueOf()+3e4,i(e),t.bus&&t.bus.trigger("select",e))},onMove:function(t,e){t.sequence.forceddate=Math.round(t.start.valueOf()/1e3),t.sequence.forcedduration=Math.round((t.end.valueOf()-t.start.valueOf())/1e3),e(t)},onRemove:function(t,e){t.sequence.deleted=!0,e(t)}},u=new vis.DataSet([]);this.timeline=new vis.Timeline(i),this.timeline.setOptions(o),this.timeline.setGroups(u),this.timeline.setItems(this.items),this.timeline.on("rangechanged",function(e){if(e.byUser){var i=s.timeline.getWindow();t.bus&&t.bus.trigger("newRange",i),s.timeBus.trigger("newValue",i.start)}}),this.timeline.on("select",function(e){t.bus&&t.bus.trigger("select",s.items.get(e.items[0]))})}),this.on("unmount",function(){this.timeline=null}),t.bus&&t.bus.on("newStartDate",function(t){s.timeline&&n(t.start,t.end)}),t.bus&&t.bus.on("newItems",function(t){s.timeline&&(s.items=t,s.timeline.setItems(s.items))}),t.bus&&t.bus.on("updateItem",function(t){s.timeline&&s.items.update(t)}),t.bus&&t.bus.on("clearItems",function(){s.items.clear()})});