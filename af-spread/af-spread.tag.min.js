riot.tag2("af-spread","<div></div>","","",function(e){function t(e){return e.split("/").map(function(e){return decodeURIComponent(e)})}var n=this,o=new EventSource(e.rootpath+"/sse"+e.subpath);o.onopen=function(){console.log("on open")},o.onerror=function(){console.log("on error")},o.onmessage=function(n){var s=n.data.split("\n"),r=t(s.shift()),a=(s.shift(),new Date(parseInt(s.shift(),10)),s.join("\n"));e.bus&&e.bus.trigger("spreadEvent",r,a),"CLOSE"==n.id&&o.close()},e.bus&&e.bus.on("postToSpread",function(e,t){var o=new XMLHttpRequest;o.open("POST",n.opts.rootpath+"/raw"+e,!0),o.onreadystatechange=function(e){4==o.readyState&&200==o.status&&console.log(o.responseText)},o.setRequestHeader("Content-Type","text/plain"),o.setRequestHeader("Authorization","Bearer FRED"),o.send(t)})});